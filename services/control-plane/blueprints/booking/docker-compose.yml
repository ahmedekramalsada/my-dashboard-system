services:
  # ---------------------------------------------------------------------------
  # Cal.com — Open Source Scheduling
  # ---------------------------------------------------------------------------
  booking:
    image: calcom/cal.com:v5.6.19
    container_name: booking-${TENANT_NAME}
    restart: unless-stopped
    env_file:
      - .env
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.admin-${TENANT_NAME}.rule=Host(`admin.${TENANT_NAME}.${DOMAIN}`)"
      - "traefik.http.routers.admin-${TENANT_NAME}.entrypoints=web"
      - "traefik.http.services.admin-${TENANT_NAME}.loadbalancer.server.port=3000"
    deploy:
      resources:
        limits:
          cpus: "1.0"
          memory: 1G

  # ---------------------------------------------------------------------------
  # Storefront — Nginx serving the user's landing page
  # ---------------------------------------------------------------------------
  storefront:
    image: nginx:alpine
    container_name: storefront-${TENANT_NAME}
    restart: unless-stopped
    volumes:
      - ./storefront.html:/usr/share/nginx/html/index.html:ro
      - ./storefront-nginx.conf:/etc/nginx/nginx.conf:ro
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.store-${TENANT_NAME}.rule=Host(`${TENANT_NAME}.${DOMAIN}`)"
      - "traefik.http.routers.store-${TENANT_NAME}.entrypoints=web"
      - "traefik.http.services.store-${TENANT_NAME}.loadbalancer.server.port=80"

networks:
  default:
    name: traefik_default
    external: true
